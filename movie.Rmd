---
title: "movie"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## R Markdown

This is an R Markdown document. Markdown is a simple formatting syntax for authoring HTML, PDF, and MS Word documents. For more details on using R Markdown see <http://rmarkdown.rstudio.com>.

When you click the **Knit** button a document will be generated that includes both content as well as the output of any embedded R code chunks within the document. You can embed an R code chunk like this:

```{r cars}
summary(cars)
x = 1
```

```{r}
library(magrittr)
library(plyr)
```
# Variables
```{r}
ratings = read.csv('ratings.csv')
movies = read.csv('movies.csv')
links = read.csv('links.csv')
tags = read.csv('tags.csv')
genome_scores = read.csv('genome-scores.csv')
genome_tags = read.csv('genome-tags.csv')
```
## Top film

```{r}

View(movies)
View(ratings)

ratings <- as.data.frame(ratings)

View(ratings$timestamp)

View(as.POSIXct(ratings$timestamp, origin="1970-01-01"))

ratings$timestamp = as.POSIXct(ratings$timestamp, origin="1970-01-01")

?substr

ratings$timestamp = as.integer(substr(ratings$timestamp, 1, 4))

ratings = as.data.frame(ratings)
```




```{r}

#Meilleure ratings
# nbview = aggregate(ratings, list(Movie=ratings.movieId), sum)
(movie_views = count(ratings, vars = "movieId"))



#top_view = head(movie_views[order(movie_views$freq, decreasing = TRUE),], 100)
top_view = merge(x = movies, y = movie_views, by.x = "movieId", by.y = "movieId")

top_view_1 = as.data.frame(top_view)

?sort

top_view_1 = top_view_1[order(top_view_1$freq, decreasing = TRUE),]

View(top_view_1)

length(top_view_1[top_view_1$freq > 1000,]$freq)/length(top_view_1$freq)

hist(top_view_1[top_view_1$freq > 1000,]$freq)

#boxplot(top_view_1[top_view_1$freq > 1000,]$freq)

top_view_1 = top_view_1[top_view_1$freq > 1000,]
View(top_view_1)


top_view_2 = merge(x = top_view_1, y = ratings, by.x = "movieId", by.y = "movieId")



boxplot(top_view_2$rating[top_view_2$movieId == 1], col="blue",outline = FALSE)


summary(top_view_2$rating[top_view_2$movieId == 1])[2]

top_view_2["summary"]=0

View(top_view_2)



summary(top_view_2$rating)

top_view_2["summary"]=summary(top_view_2$rating[top_view_2$movieId == ])[2]



#top_view_2$rating[]

unique(top_view_2$movieId)
summary()
#summary(top_view_2$rating)


View(top_view_2)



```

```{r}


#### Drop outliers 

drop_outliers = function() {
  for(i in )
}

drop_outliers()


```


```{r}

#1. Analyse de variables une par une 

## outliers 

##Liste de films 
##
## distribution des avis par film 
##boxplot 


##boxplot des 5 premiers films les plus vus 


##barplot des 5 premiers films les plus vues 


#2. Nombre d'avis par année (par différence avec la sortie du film)



#3. Pour chaque année, les 5 tags les plus populaires (horreur, science, etc)
#Evolution au cours des années 

#4. Regardez ce qui a été fait ? 













```






```{r}



avg_ratings = ddply(ratings, .(movieId), summarize, Avg=mean(rating))
top_populaire = head(avg_ratings[order(avg_ratings$Avg, decreasing = TRUE),], 100)
movie_top = merge(x = movies, y = top_populaire, by.x = "movieId", by.y = "movieId")
View(movie_top)

#Merge
#all_data c'est toutes les données pour les films
all_data = merge(x =ratings, y = movies, by.x = "movieId", by.y = "movieId")
all_data = merge(x = all_data, y = links, by.x = "movieId", by.y = "movieId")
all_data = merge(x = all_data, y = tags, by.x = "movieId", by.y = "movieId")
all_data = merge(x = all_data, y = genome_scores, by.x = "movieId", by.y = "movieId")




```

## Including Plots

You can also embed plots, for example:

```{r pressure, echo=FALSE}
plot(pressure)
```

Note that the `echo = FALSE` parameter was added to the code chunk to prevent printing of the R code that generated the plot.
